var pokemon;var urlBase="https://pokeapi.co/api/v2/";var especie;var evolucion;var idEvoluciones=[];var evolutionArray=[];var cantidadEv=0;var idActual;function cargar(g){idActual=g;get("#name").innerHTML="";get("#id-pokemon").innerHTML="";get("#tipo1").innerHTML="";get("#divTipo2").style.display="none";get("#image").src="imagenes/cargando.gif";get("#altura").innerHTML="";get("#peso").innerHTML="";get("#habilidades").innerHTML="";get("#movimientos").innerHTML="";get("#habitat").innerHTML="";get("#descripcion").innerHTML="";get("#inicio").style.display="none";get("#layout-izquierda").style.display="block";get("#layout-derecha").style.display="block";get("#divEvoluciones").innerHTML="";idEvoluciones=[];evolutionArray=[];cantidadEv=0;var h=new XMLHttpRequest();h.onreadystatechange=function(){if(this.readyState==4&&this.status==200){pokemon=JSON.parse(this.responseText);mostrarPropiedades()}};h.open("GET",urlBase+"pokemon/"+g,true);h.send();cargarEspecie(g);if(document.cookie.length>0){var e=new XMLHttpRequest();e.onreadystatechange=function(){if(this.readyState==4&&this.status==200){favoritos=this.responseText.split(",");for(var a=0;a<favoritos.length-1;a++){if(favoritos[a]==g){get("#btnFavorito").className="";break}}}};var f=document.cookie.split(",")[0].split("usuarioLogueado=")[1];e.open("GET","/favoritosByUsuario/"+f,true);e.send()}}function mostrarPropiedades(){get("#name").innerHTML=pokemon.name;get("#id-pokemon").innerHTML=pokemon.id;get("#tipo1").innerHTML=pokemon.types[0].type.name;if(pokemon.types.length>1){get("#divTipo2").style.display="inline-block";get("#tipo2").innerHTML=pokemon.types[1].type.name}get("#image").src=pokemon.sprites.front_default;get("#altura").innerHTML="Altura: "+pokemon.height/10+" m";get("#peso").innerHTML="Peso: "+pokemon.weight/10+" kg";for(var b=0;(b<pokemon.abilities.length&&b<5);b++){get("#habilidades").innerHTML+="<h2>"+pokemon.abilities[b].ability.name+"</h2>"}for(var b=0;(b<pokemon.moves.length&&b<5);b++){get("#movimientos").innerHTML+="<h2>"+pokemon.moves[b].move.name+"</h2>"}}function cargarEspecie(c){var d=new XMLHttpRequest();d.onreadystatechange=function(){if(this.readyState==4&&this.status==200){especie=JSON.parse(this.responseText);if(especie.habitat){get("#habitat").innerHTML=especie.habitat.name}else{get("#habitat").innerHTML="Desconocido"}for(var a=0;a<especie.flavor_text_entries.length;a++){if(especie.flavor_text_entries[a].language.name=="es"){var b=especie.flavor_text_entries[a].flavor_text;get("#descripcion").innerHTML=b;break}}requestEvoluciones(especie.evolution_chain.url)}};d.open("GET",urlBase+"pokemon-species/"+c,true);d.send()}function requestEvoluciones(d){var c=new XMLHttpRequest();c.onreadystatechange=function(){if(this.readyState==4&&this.status==200){evolucion=JSON.parse(this.responseText);cargarEvoluciones(evolucion)}};c.open("GET",d,true);c.send()}function cargarEvoluciones(j){var g=0;var h=document.getElementById("divEvoluciones");h.innerHTML="";evolutionArray=j.chain;cantidadEv=evolutionArray.evolves_to.length;for(var k=-1;k<cantidadEv;k++){if(k<0){idEvoluciones.push(j.chain.species.url.slice(42,-1));EvolucionURL(parseInt(idEvoluciones[0]),h,evolutionArray.species.name)}else{idEvoluciones.push(j.chain.evolves_to[k].species.url.slice(42,-1));EvolucionURL(parseInt(idEvoluciones[k+1]),h,j.chain.evolves_to[k].species.name);g=idEvoluciones.length}}for(var k=0;k<evolutionArray.evolves_to.length;k++){for(var f=0;f<evolutionArray.evolves_to[k].evolves_to.length;f++){idEvoluciones.push(j.chain.evolves_to[k].evolves_to[f].species.url.slice(42,-1));EvolucionURL(parseInt(idEvoluciones[g]),h,evolutionArray.evolves_to[k].evolves_to[f].species.name)}}}function EvolucionURL(f,g,h){var e=new XMLHttpRequest();e.onreadystatechange=function(){if(this.readyState==4&&this.status==200){pokemon=JSON.parse(this.responseText);GenerarDivEvolucion(g,pokemon.sprites.front_default,h,f)}};e.open("GET","https://pokeapi.co/api/v2/pokemon/"+f,true);e.send()}function GenerarDivEvolucion(h,e,g,f){get("#divEvoluciones").innerHTML+="<div class='pokemonEvolucion' onclick='nuevoPokemon("+f+")' ><img src='"+e+"'><h2>"+g+"</h2></div>"}var pokecomply=new Array();window.onload=function(){var b=new XMLHttpRequest();b.onreadystatechange=function(){if(this.readyState==4&&this.status==200){get("#txtBusqueda").removeAttribute("disabled");get("#txtBusqueda").setAttribute("placeholder","pikachu");var a=JSON.parse(this.responseText);for(i=0;i<802;i++){pokecomply[i]=String(a.results[i].name)}creadorDeListas(pokecomply)}};b.open("GET","https://pokeapi.co/api/v2/pokemon/?limit=802",true);b.send();if(document.cookie.length>0){setInterval(function(){actualizarLogin()},1000);get("#loginRegistro").style.display="none";get("#usuarioLogueado").innerHTML='<a href="perfil.html">'+document.cookie.split(",")[1]+"   </a>";get("#usuarioLogueado").innerHTML+='<a href="#" onclick="cerrarSesion()">  |  Cerrar Sesión </a>';get("#usuarioLogueado").style.display="inline-block";get("#register").style.display="none"}};function creadorDeListas(f){for(i=0;i<802;i++){var d=document.createElement("OPTION");var e=document.createTextNode(f[i]);d.appendChild(e);d.setAttribute("id",i);d.setAttribute("name",f[i]);document.getElementById("lista").appendChild(d)}}function llenarPokemon(g){if(g.keyCode==13){buscador=document.getElementById("txtBusqueda").value;if(Existe(pokecomply,buscador)){var f=document.getElementsByName(buscador);var e=f[0].getAttribute("id");var h=parseInt(e)+1;cargar(h)}else{alert("Busqueda no válida")}}}function Existe(g,f){var e=g.length;for(var h=0;h<e;h++){if(g[h]==f){return true}}return false}function nuevoPokemon(b){cargar(b)}function get(b){return document.querySelector(b)}get("#btnEvoluciones").onclick=function(){get("#divHabilidades").style.display="none";get("#divEvoluciones").style.display="block"};get("#btnHabilidades").onclick=function(){get("#divHabilidades").style.display="block";get("#divEvoluciones").style.display="none"};get("#formRegistro").onsubmit=function(j){j.preventDefault();var h=get("#txtNombre").value;var k=document.getElementById("txtEmailRegistro").value;var e=document.getElementById("txtPasswordRegistro").value;var g=new XMLHttpRequest();g.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var a=JSON.parse(this.responseText);if(a.id===null){get("#errorRegistro").innerHTML="Correo ya registrado";get("#errorRegistro").style.display="block"}else{var b=new Date();b.setTime(b.getTime()+(60*1000));var c="; expires="+b.toGMTString();document.cookie="usuarioLogueado="+[a.id,a.name,a.email]+c;get("#loginRegistro").style.display="none";get("#usuarioLogueado").innerHTML='<a href="perfil.html">'+a.name+"</a>";get("#usuarioLogueado").innerHTML+='<a href="#" onclick="cerrarSesion()">  |  Cerrar Sesión</a>';get("#usuarioLogueado").style.display="inline-block";get("#register").style.display="none";setInterval(function(){actualizarLogin()},1*1000)}}};g.open("POST","/crearUsuario");g.setRequestHeader("Content-Type","application/json");g.setRequestHeader("Accept","application/json");g.send(JSON.stringify({id:0,name:h,email:k,contrasena:e}))};function actualizarLogin(){if(document.cookie.length===0){get("#loginRegistro").style.display="inline-block";get("#usuarioLogueado").innerHTML="";get("#usuarioLogueado").style.display="none"}}get("#formLogin").onsubmit=function(g){g.preventDefault();var h=document.getElementById("txtEmailLogin").value;var e=document.getElementById("txtPasswordLogin").value;var f=new XMLHttpRequest();f.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var a=JSON.parse(this.responseText);if(a.id===null){get("#errorLogin").innerHTML="Contraseña o correo incorrecto";get("#errorLogin").style.display="block"}else{var b=new Date();b.setTime(b.getTime()+(60*1000));var c="; expires="+b.toGMTString();document.cookie="usuarioLogueado="+[a.id,a.name,a.email]+c;get("#loginRegistro").style.display="none";get("#usuarioLogueado").innerHTML='<a href="perfil.html">'+a.name+"</a>";get("#usuarioLogueado").innerHTML+='<a href="#" onclick="cerrarSesion()">  |  Cerrar Sesión</a>';get("#usuarioLogueado").style.display="inline-block";get("#register").style.display="none";setInterval(function(){actualizarLogin()},1*1000)}}};g.preventDefault();f.open("POST","/loguearse");f.setRequestHeader("Content-Type","application/json");f.setRequestHeader("Accept","application/json");f.send(JSON.stringify({id:0,name:"",email:h,contrasena:e}))};get("#btnFavorito").onclick=function(){if(get("#btnFavorito").className===""){alert("Ya está agregado a favoritos")}else{if(document.cookie.length>0){this.className="";var c=new XMLHttpRequest();c.open("POST","/pokemonFavoritos",true);var d=document.cookie.split(",")[0];d=d.split("usuarioLogueado=")[1];c.send(d+","+idActual)}else{alert("debe registrarse")}}};function cerrarSesion(){document.cookie="usuarioLogueado=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"};
